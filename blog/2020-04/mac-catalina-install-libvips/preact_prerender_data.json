{"url":"/blog/2020-04/mac-catalina-install-libvips","date":"2020-04-06","tags":["mac"],"content":"\ngatsby 的图片处理库`sharp`很方便，但是 sharp 依赖 c++编写的 `libvips`。\n当 Mac 升级到 catalina(10.15), `brew`安装时一直失败，当尝试源码编译，会出现`tiff`依赖的错误。\n还有`zlib`在 catalina 默认的 `pkg-config`的配置`zlib.pc`错误。针对我遇到的情形，解决方式如下。\n\n```\n// 从github 下载最新的gz包，vips-8.9.1.tar.gz\n\ntar xf vips-8.9.1.tar.gz\ncd vips-8.9.1\n\n./configuration --with-jpeg --with-png --without-tiff\n\nmake\n\nsudo make install\n\nrm -rf node_modules\n\nnpm i --unsafe-perm --build-from-source --verbose\n\n```\n\n改进之处\n\n- 在 markdown 内引入 png 图片，gatsby 有时会编译出错 (可能是 libvips 编译的参数不对， 或者`gatsby-plugin-sharp`的 bug)\n- `brew info vips` 显示的 vips 版本始终是 8.8.x，尝试升级 brew，拉取`brew/versions`仓库也报错，可能是`brew/core`的 bug\n- 等 brew 官方发新版，最简单的就是通过`brew install vips`安装 libvips\n\n参考文档\n\n- [https://sharp.pixelplumbing.com/install](https://sharp.pixelplumbing.com/install)\n- [https://libvips.github.io/libvips/install.html#building-libvips-from-a-source-tarball](https://libvips.github.io/libvips/install.html#building-libvips-from-a-source-tarball)\n- [https://github.com/gatsbyjs/gatsby/issues/21032](https://github.com/gatsbyjs/gatsby/issues/21032)\n"}
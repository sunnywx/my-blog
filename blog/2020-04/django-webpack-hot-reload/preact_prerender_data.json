{"url":"/blog/2020-04/django-webpack-hot-reload","date":"2020-04-07","tags":["webpack"],"content":"\n## 1. 设置后端环境\n\n```shell\n# init python virtrual env\npip install virtualenv\nvirtualenv venv\nsource ./venv/bin/activate\n\npip install django-webpack-loader\n```\n\n## 2. 设置 django 的 settings.py\n\n```shell\nWEBPACK_LOADER = {\n    'DEFAULT': {\n        'CACHE': not DEBUG,\n        'BUNDLE_DIR_NAME': 'dist/', # must end with slash\n        'STATS_FILE': os.path.join(BASE_DIR, 'static/dist/webpack-stats.json'),\n        'POLL_INTERVAL': 0.1,\n        'TIMEOUT': None,\n        'IGNORE': ['.+\\.hot-update.js', '.+\\.map']\n    }\n}\n\n```\n\n## 3. 设置 webpack (开发环境)\n\n```shell\nconst path = require('path')\nconst webpackNotifier = require('webpack-notifier')\nconst ManifestPlugin = require('webpack-manifest-plugin')\nconst BundleTracker = require('webpack-bundle-tracker')\n\nconst devServerPort = process.env.DEV_SERVER_PORT || 9000\n\nmodule.exports = {\n  mode: 'development',\n  devtool: 'cheap-module-eval-source-map',\n  entry: './src/index.js',\n  output: {\n    path: path.resolve(__dirname, 'static/dist'),\n    filename: '[name].js',\n    chunkFilename: '[name].chunk.js',\n\n    // if you want hmr, point to webpack-dev-server path, not django static file\n    publicPath: `http://localhost:${devServerPort}/static/dist/`\n  },\n  devServer: {\n    contentBase: path.resolve(__dirname, 'static/dist'),\n    compress: true,\n    port: process.env.DEV_SERVER_PORT || 9000,\n    headers: {\n      'Access-Control-Allow-Origin': '*'\n    },\n    historyApiFallback: true,\n\n    // HMR\n    hotOnly: true,\n    inline: true,\n    clientLogLevel: 'warn'\n  },\n  plugins: [\n    new ManifestPlugin({\n      publicPath: 'static/dist/'\n    }),\n    new BundleTracker({\n      filename: './static/dist/webpack-stats.json'\n    })\n  ]\n}\n\n```\n\n## 4. django 模板\n\n```html\n{% load custom_tags %} {% load render_bundle from webpack_loader %}\n<!DOCTYPE html>\n<html lang=\"{{ site.lang|default:'zh-cn' }}\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta\n      name=\"viewport\"\n      content=\"width=device-width, initial-scale=1, shrink-to-fit=no\"\n    />\n\n    {% block styles %} {% if is_prod %}\n    <link rel=\"stylesheet\" href=\"{{ 'styles.css' | get_manifest_asset }}\" />\n    {% endif %} {% endblock %}\n  </head>\n  <body>\n    {% block content %}\n    <div id=\"app\"></div>\n    {% endblock %} {% block scripts %} {% if is_prod %}\n    <script src=\"{{ 'styles.js' | get_manifest_asset }}\"></script>\n    <script src=\"{{ 'main.js' | get_manifest_asset }}\"></script>\n    {% else %} {% render_bundle 'main' %} {% endif %} {% endblock %}\n  </body>\n</html>\n```\n\n### 实际项目中的演示：\n\n![django webpack热加载](/assets/images/django-webpack-hot-reload.jpg)\n"}
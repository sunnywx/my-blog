<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>sunnywang blog</title><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><link rel="apple-touch-icon" href="/assets/icons/apple-touch-icon.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#673ab8"><link rel="shortcut icon" href="/favicon.ico"><style>html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}h1{font-size:2em;margin:.67em 0}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}code{font-family:monospace,monospace;font-size:1em}img{border-style:none}:root{--font-size-base:1rem;--font-size-x2:1.25rem;--header-height:56px;--shrink-header-height:112px;--bg-light:#fff;--color-light:#000;--bg-dark:#222427;--color-dark:#fff;--hl:rgba(192,164,243,0.5)}body,html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background:#fff;font-family:Roboto Light,arial,sans-serif;font-weight:400;height:100%;margin:0;overflow:hidden;padding:0;width:100%}*{box-sizing:border-box}p{line-height:1.5}.main{display:-ms-flexbox;display:flex;height:calc(100% - var(--header-height));position:relative;top:56px}@media (max-width:600px){.main{height:calc(100% - var(--shrink-header-height));top:var(--shrink-header-height)}}.main>div:last-child{-ms-flex:1;flex:1;overflow:auto;padding:1rem}.main>div:last-child pre{background:#1f1f34;border:1px solid #3f4757;border-radius:6px;color:wheat;max-height:600px;overflow:auto;padding:1rem}.main>div:last-child a{color:#59b9d9;text-decoration:none}.main>div:last-child a:active,.main>div:last-child a:hover{color:#3838da}.main>div:last-child img{width:100%}code[class*=language-]{word-wrap:normal;background:none;color:#fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 -.1em .2em #000;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::selection,code[class*=language-] ::selection{background:hsla(0,0%,93%,.15);text-shadow:none}.header__DTK6R{-ms-flex-pack:justify;background:#fff;box-shadow:0 0 5px rgba(0,0,0,.5);-ms-flex-wrap:wrap;flex-wrap:wrap;justify-content:space-between;left:0;min-height:56px;padding:0;position:fixed;top:0;width:100%;z-index:50}.header__DTK6R,.header__DTK6R>div:first-child{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex}.header__DTK6R>div:first-child{margin-left:10px}.header__DTK6R>div:first-child>h1{cursor:pointer}.header__DTK6R>div:first-child>span{-ms-flex-pack:center;-ms-flex-align:center;align-items:center;border-radius:50%;cursor:pointer;display:-ms-inline-flexbox;display:inline-flex;font-size:16px;height:36px;justify-content:center;opacity:.5;width:36px}.header__DTK6R>div:first-child>span:hover{background:#d3d3d3}.header__DTK6R h1{float:left;font-size:24px;font-weight:400;line-height:56px;margin:0;padding:0 8px}.header__DTK6R nav{-ms-flex-align:center;-ms-flex-pack:justify;align-items:center;display:-ms-flexbox;display:flex;justify-content:space-between;margin-right:1rem}@media (max-width:600px){.header__DTK6R nav{width:100%}}.header__DTK6R nav a{display:inline-block;height:56px;line-height:56px;min-width:50px;padding:0 15px;text-align:center;text-decoration:none;will-change:background-color}.header__DTK6R nav a:active,.header__DTK6R nav a:hover{border-bottom:2px solid rgba(0,0,0,.4)}.header__DTK6R nav .icon__ftgq-{-ms-flex-align:center;align-items:center;color:#a9a9a9;cursor:pointer;display:-ms-inline-flexbox;display:inline-flex;font-size:20px;min-width:unset;padding:0;text-decoration:none}.header__DTK6R nav .icon__ftgq-:last-child{margin-left:20px}.header__DTK6R nav .icon__ftgq-:hover{border:none;color:#000}.nav__-dEyW{overflow:auto;padding:10px;transition:all .5s ease;width:30ch;z-index:20}@media (max-width:600px){.nav__-dEyW{height:calc(100% - var(--shrink-header-height));position:fixed}}.wrap__VyOVO{padding:1rem;position:relative}.wrap__VyOVO .header__dNwEz{margin-bottom:32px}.wrap__VyOVO .header__dNwEz>h1{font-size:2rem;font-weight:600;text-align:center}.wrap__VyOVO .header__dNwEz>div{-ms-flex-pack:justify;-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;justify-content:space-between}.wrap__VyOVO .header__dNwEz>div>div{-ms-flex-align:center;-ms-flex-preferred-size:80%;-ms-flex-positive:0;align-items:center;display:-ms-inline-flexbox;display:inline-flex;flex-basis:80%;flex-grow:0;-ms-flex-wrap:wrap;flex-wrap:wrap}.wrap__VyOVO .header__dNwEz>div>div>span:first-child{margin-right:8px}.wrap__VyOVO .header__dNwEz>div>div>span:first-child~a{background:#ddd;border-radius:8px;display:-ms-inline-flexbox;display:inline-flex;margin-right:8px;padding:3px 6px}.wrap__VyOVO .header__dNwEz>div>span{-ms-flex-align:center;align-items:center;color:grey;display:-ms-inline-flexbox;display:inline-flex;min-width:-webkit-max-content;min-width:max-content}.wrap__VyOVO .header__dNwEz>div>span svg{margin-right:5px}.wrap__VyOVO>.pager__T39MM{-ms-flex-pack:justify;display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:1rem;justify-content:space-between;margin-top:32px}</style><link href="/bundle.c7ff4.css" rel="stylesheet" media="only x" onload="this.media='all'"><noscript><link rel="stylesheet" href="/bundle.c7ff4.css"></noscript></head><body><header class="header__DTK6R"><div><span id="toggle-side-nav"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M16 5H0V4h16v1zm0 8H0v-1h16v1zm0-4.008H0V8h16v.992z"></path></svg></span><h1>sunnywang</h1></div><nav><div><a href="/blogs" class="">Blogs</a><a href="/tags" class="">Tags</a><a href="/projects" class="">Projects</a><a href="/about" class="">About</a></div><div><span class="icon__ftgq-"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 13V2a6 6 0 1 1 0 12z"></path></svg></span><a href="https://github.com/sunnywx" target="_blank" rel="noreferrer noopener" class="icon__ftgq-"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M12 0a12 12 0 1 0 0 24 12 12 0 0 0 0-24zm3.163 21.783h-.093a.513.513 0 0 1-.382-.14.513.513 0 0 1-.14-.372v-1.406c.006-.467.01-.94.01-1.416a3.693 3.693 0 0 0-.151-1.028 1.832 1.832 0 0 0-.542-.875 8.014 8.014 0 0 0 2.038-.471 4.051 4.051 0 0 0 1.466-.964c.407-.427.71-.943.885-1.506a6.77 6.77 0 0 0 .3-2.13 4.138 4.138 0 0 0-.26-1.476 3.892 3.892 0 0 0-.795-1.284 2.81 2.81 0 0 0 .162-.582c.033-.2.05-.402.05-.604 0-.26-.03-.52-.09-.773a5.309 5.309 0 0 0-.221-.763.293.293 0 0 0-.111-.02h-.11c-.23.002-.456.04-.674.111a5.34 5.34 0 0 0-.703.26 6.503 6.503 0 0 0-.661.343c-.215.127-.405.249-.573.362a9.578 9.578 0 0 0-5.143 0 13.507 13.507 0 0 0-.572-.362 6.022 6.022 0 0 0-.672-.342 4.516 4.516 0 0 0-.705-.261 2.203 2.203 0 0 0-.662-.111h-.11a.29.29 0 0 0-.11.02 5.844 5.844 0 0 0-.23.763c-.054.254-.08.513-.081.773 0 .202.017.404.051.604.033.199.086.394.16.582A3.888 3.888 0 0 0 5.702 10a4.142 4.142 0 0 0-.263 1.476 6.871 6.871 0 0 0 .292 2.12c.181.563.483 1.08.884 1.516.415.422.915.75 1.466.964.653.25 1.337.41 2.033.476a1.828 1.828 0 0 0-.452.633 2.99 2.99 0 0 0-.2.744 2.754 2.754 0 0 1-1.175.27 1.788 1.788 0 0 1-1.065-.3 2.904 2.904 0 0 1-.752-.824 3.1 3.1 0 0 0-.292-.382 2.693 2.693 0 0 0-.372-.343 1.841 1.841 0 0 0-.432-.24 1.2 1.2 0 0 0-.481-.101c-.04.001-.08.005-.12.01a.649.649 0 0 0-.162.02.408.408 0 0 0-.13.06.116.116 0 0 0-.06.1.33.33 0 0 0 .14.242c.093.074.17.131.232.171l.03.021c.133.103.261.214.382.333.112.098.213.209.3.33.09.119.168.246.231.381.073.134.15.288.231.463.188.474.522.875.954 1.145.453.243.961.364 1.476.351.174 0 .349-.01.522-.03.172-.028.343-.057.515-.091v1.743a.5.5 0 0 1-.533.521h-.062a10.286 10.286 0 1 1 6.324 0v.005z"></path></svg></a></div></nav></header><div class="main"><div class="nav__-dEyW"></div><div class="wrap__VyOVO"><div class="header__dNwEz"><h1></h1><div><div><span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.2 2H8.017l-.353.146L1 8.81v.707L6.183 14.7h.707l2.215-2.215A4.48 4.48 0 0 0 15.65 9c.027-.166.044-.332.051-.5a4.505 4.505 0 0 0-2-3.74V2.5l-.5-.5zm-.5 2.259A4.504 4.504 0 0 0 11.2 4a.5.5 0 1 0 0 1 3.5 3.5 0 0 1 1.5.338v2.138L8.775 11.4a.506.506 0 0 0-.217.217l-2.022 2.022-4.475-4.476L8.224 3H12.7v1.259zm1 1.792a3.5 3.5 0 0 1 1 2.449 3.438 3.438 0 0 1-.051.5 3.487 3.487 0 0 1-4.793 2.735l3.698-3.698.146-.354V6.051z"></path></svg></span><a href="/tags/wasm">wasm</a><a href="/tags/rust">rust</a></div><span><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.568 1.031A6.8 6.8 0 0 1 12.76 3.05a7.06 7.06 0 0 1 .46 9.39 6.85 6.85 0 0 1-8.58 1.74 7 7 0 0 1-3.12-3.5 7.12 7.12 0 0 1-.23-4.71 7 7 0 0 1 2.77-3.79 6.8 6.8 0 0 1 4.508-1.149zM9.04 13.88a5.89 5.89 0 0 0 3.41-2.07 6.07 6.07 0 0 0-.4-8.06 5.82 5.82 0 0 0-7.43-.74 6.06 6.06 0 0 0 .5 10.29 5.81 5.81 0 0 0 3.92.58zM7.375 6h1.25V5h-1.25v1zm1.25 1v4h-1.25V7h1.25z"></path></svg> 2020-10-14</span></div></div><div><p><img src="/assets/images/js-wasm-bench.png" alt=""></p><h2 id="rust-环境准备">Rust 环境准备</h2><p>我准备用<code>rust</code>来编译到<code>wasm</code>，当然你也可以用 <code>c/c++</code>, <code>go</code>, <code>assemblyScript/typescript</code> 来 compile 到 wasm.</p><p>首选准备 rust 环境，安装<code>rustup</code></p><pre><code class="language-shell">curl --proto '=https' --tlsv1.2 https://sh.rustup.rs -sSf | sh

export PATH="$HOME/.cargo/bin:$PATH"

# 检查rustc 安装成功
rustc --version
# 检查 cargo 安装成功
cargo --version

# 安装wasm的编译目标
rustup target add wasm32-unknown-unknown
</code></pre><h2 id="创建-rust-lib，编译到-wasm">创建 rust lib，编译到 wasm</h2><p>使用 cargo(rust 的包管理器和 build 工具) 创建一个 type 为 library 的项目</p><pre><code class="language-shell">cargo new begin_wasm --lib
</code></pre><p>cargo 初始化的目录结构是</p><pre><code>├── Cargo.toml
└── src
    └── lib.rs
</code></pre><p><code>src/lib.rs</code>就是要编译到 wasm 的 rust 文件，先加入斐波那契数的函数，稍后编译到 wasm 里。</p><pre><code class="language-rust">#[no_mangle]
pub fn fib(n: u32) -&gt; u64 {
    match n {
        0 =&gt; 1,
        1 =&gt; 1,
        _ =&gt; fib(n - 1) + fib(n - 2),
    }
}
</code></pre><p>编译到 wasm</p><pre><code class="language-shell">cargo build --target wasm32-unknown-unknown
</code></pre><p>这时在项目目录下会多出一个<code>target</code>目录，默认 cargo 是在 debug 模式下编译，wasm 文件体积会稍大点。 生成的 wasm 文件在 <code>target/wasm32-unknwon-unknown/debug/begin_wasm.wasm</code></p><h2 id="js-端创建测试页面">JS 端创建测试页面</h2><pre><code class="language-shell">touch index.html
</code></pre><p>index.html 的内容如下</p><pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;rust wasm&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h2&gt;Fibnacci benchmark: JS vs Wasm&lt;/h2&gt;

    &lt;div id="result"&gt;
      &lt;div id="fib-js"&gt;&lt;/div&gt;

      &lt;div id="fib-wasm"&gt;&lt;/div&gt;
    &lt;/div&gt;

    &lt;script&gt;
      const wasm_file = "target/wasm32-unknown-unknown/debug/begin_wasm.wasm"

      const fib = n =&gt; {
        if (n === 0 || n === 1) {
          return 1
        }
        return fib(n - 1) + fib(n - 2)
      }

      const t1 = Date.now()
      const res_js = fib(40)
      const t2 = Date.now()

      document.getElementById(
        "fib-js"
      ).innerHTML = `==JS==: Calc fib(40), time=${(t2 - t1) /
        1000}s, res=${res_js}`

      const memory = new WebAssembly.Memory({ initial: 10, maximum: 100 }) // alloc wasm memory size

      WebAssembly.instantiateStreaming(fetch(wasm_file), {
        js: { mem: memory },
      }).then(mod =&gt; {
        const wasm_exports = mod.instance.exports

        const t1 = Date.now()
        const res_wasm = wasm_exports.fib(40)
        const t2 = Date.now()

        document.getElementById(
          "fib-wasm"
        ).innerHTML = `==WASM==: Calc fib(40), time=${(t2 - t1) /
          1000}s, res=${res_wasm}`
      })
    &lt;/script&gt;
  &lt;/body&gt;
  &lt;html&gt;&lt;/html&gt;
&lt;/html&gt;
</code></pre><h2 id="开启本地-http-server">开启本地 http server</h2><p>本地测试的话，可以有很多方式开启 http server，你可以用 cargo 安装 rust 版的 http server</p><pre><code class="language-shell">cargo install https

http  # 启动http server
</code></pre><p>也可以 nodejs 的 npm 安装 http server</p><pre><code class="language-shell">npm i http-server

http-server .
</code></pre><p>然后打开浏览器(比如我的 chrome)，进到测试页面, benchmark 对比：</p><p><img src="/assets/images/js-wasm-fib.jpg" alt=""></p><h2 id="总结">总结</h2><p>以上是对比 js 和 wasm 计算 斐波那契数列的第 42 项，也是很大的一个数了，js 用的时间竟然比 wasm 少?（什么原因呢，各位观众可以在评论区留言发表看法:-p） wasm 的性能和 c/c++差不多，这里应该是 chrome v8 引擎在处理 js 的计算时做了编译优化，让 js 计算 fib(42) 甚至比 wasm 还快。</p><p>当然局部的 benchmark 对比看不出什么优势，在重计算的项目(cpu 密集型)中，wasm 的优势就会比 js 明显。</p><p>未来 WASM 会和 JS 优势互补，二者不是对立的关系，wasm 也不会取代 js，wasm 只是增强了 js，就像 typescript 只是给 js 加了类型和静态分析。</p><p>很愉快的 WASM 之旅，happy coding :)</p></div><div class="pager__T39MM"></div><div id="gitalk-container"></div></div></div><script type="__PREACT_CLI_DATA__">%7B%22preRenderData%22:%7B%22url%22:%22/blog/2020-10/js-wasm-fibonacci-compare%22,%22date%22:%222020-10-14%22,%22tags%22:%5B%22wasm%22,%22rust%22%5D,%22content%22:%22%5Cn!%5B%5D(/assets/images/js-wasm-bench.png)%5Cn%5Cn##%20Rust%20%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87%5Cn%5Cn%E6%88%91%E5%87%86%E5%A4%87%E7%94%A8%60rust%60%E6%9D%A5%E7%BC%96%E8%AF%91%E5%88%B0%60wasm%60%EF%BC%8C%E5%BD%93%E7%84%B6%E4%BD%A0%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%20%60c/c++%60,%20%60go%60,%20%60assemblyScript/typescript%60%20%E6%9D%A5%20compile%20%E5%88%B0%20wasm.%5Cn%5Cn%E9%A6%96%E9%80%89%E5%87%86%E5%A4%87%20rust%20%E7%8E%AF%E5%A2%83%EF%BC%8C%E5%AE%89%E8%A3%85%60rustup%60%5Cn%5Cn%60%60%60shell%20script%5Cncurl%20--proto%20'=https'%20--tlsv1.2%20https://sh.rustup.rs%20-sSf%20%7C%20sh%5Cn%5Cnexport%20PATH=%5C%22$HOME/.cargo/bin:$PATH%5C%22%5Cn%5Cn#%20%E6%A3%80%E6%9F%A5rustc%20%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%5Cnrustc%20--version%5Cn#%20%E6%A3%80%E6%9F%A5%20cargo%20%E5%AE%89%E8%A3%85%E6%88%90%E5%8A%9F%5Cncargo%20--version%5Cn%5Cn#%20%E5%AE%89%E8%A3%85wasm%E7%9A%84%E7%BC%96%E8%AF%91%E7%9B%AE%E6%A0%87%5Cnrustup%20target%20add%20wasm32-unknown-unknown%5Cn%5Cn%60%60%60%5Cn%5Cn##%20%E5%88%9B%E5%BB%BA%20rust%20lib%EF%BC%8C%E7%BC%96%E8%AF%91%E5%88%B0%20wasm%5Cn%5Cn%E4%BD%BF%E7%94%A8%20cargo(rust%20%E7%9A%84%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8%E5%92%8C%20build%20%E5%B7%A5%E5%85%B7)%20%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%20type%20%E4%B8%BA%20library%20%E7%9A%84%E9%A1%B9%E7%9B%AE%5Cn%5Cn%60%60%60shell%20script%5Cncargo%20new%20begin_wasm%20--lib%5Cn%60%60%60%5Cn%5Cncargo%20%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E6%98%AF%5Cn%5Cn%60%60%60%5Cn%E2%94%9C%E2%94%80%E2%94%80%20Cargo.toml%5Cn%E2%94%94%E2%94%80%E2%94%80%20src%5Cn%20%20%20%20%E2%94%94%E2%94%80%E2%94%80%20lib.rs%5Cn%60%60%60%5Cn%5Cn%60src/lib.rs%60%E5%B0%B1%E6%98%AF%E8%A6%81%E7%BC%96%E8%AF%91%E5%88%B0%20wasm%20%E7%9A%84%20rust%20%E6%96%87%E4%BB%B6%EF%BC%8C%E5%85%88%E5%8A%A0%E5%85%A5%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E7%9A%84%E5%87%BD%E6%95%B0%EF%BC%8C%E7%A8%8D%E5%90%8E%E7%BC%96%E8%AF%91%E5%88%B0%20wasm%20%E9%87%8C%E3%80%82%5Cn%5Cn%60%60%60rust%5Cn#%5Bno_mangle%5D%5Cnpub%20fn%20fib(n:%20u32)%20-%3E%20u64%20%7B%5Cn%20%20%20%20match%20n%20%7B%5Cn%20%20%20%20%20%20%20%200%20=%3E%201,%5Cn%20%20%20%20%20%20%20%201%20=%3E%201,%5Cn%20%20%20%20%20%20%20%20_%20=%3E%20fib(n%20-%201)%20+%20fib(n%20-%202),%5Cn%20%20%20%20%7D%5Cn%7D%5Cn%60%60%60%5Cn%5Cn%E7%BC%96%E8%AF%91%E5%88%B0%20wasm%5Cn%5Cn%60%60%60shell%20script%5Cncargo%20build%20--target%20wasm32-unknown-unknown%5Cn%60%60%60%5Cn%5Cn%E8%BF%99%E6%97%B6%E5%9C%A8%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E4%B8%8B%E4%BC%9A%E5%A4%9A%E5%87%BA%E4%B8%80%E4%B8%AA%60target%60%E7%9B%AE%E5%BD%95%EF%BC%8C%E9%BB%98%E8%AE%A4%20cargo%20%E6%98%AF%E5%9C%A8%20debug%20%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%BC%96%E8%AF%91%EF%BC%8Cwasm%20%E6%96%87%E4%BB%B6%E4%BD%93%E7%A7%AF%E4%BC%9A%E7%A8%8D%E5%A4%A7%E7%82%B9%E3%80%82%5Cn%E7%94%9F%E6%88%90%E7%9A%84%20wasm%20%E6%96%87%E4%BB%B6%E5%9C%A8%20%60target/wasm32-unknwon-unknown/debug/begin_wasm.wasm%60%5Cn%5Cn##%20JS%20%E7%AB%AF%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E9%A1%B5%E9%9D%A2%5Cn%5Cn%60%60%60shell%20script%5Cntouch%20index.html%5Cn%60%60%60%5Cn%5Cnindex.html%20%E7%9A%84%E5%86%85%E5%AE%B9%E5%A6%82%E4%B8%8B%5Cn%5Cn%60%60%60html%5Cn%3C!DOCTYPE%20html%3E%5Cn%3Chtml%3E%5Cn%20%20%3Chead%3E%5Cn%20%20%20%20%3Ctitle%3Erust%20wasm%3C/title%3E%5Cn%20%20%3C/head%3E%5Cn%20%20%3Cbody%3E%5Cn%20%20%20%20%3Ch2%3EFibnacci%20benchmark:%20JS%20vs%20Wasm%3C/h2%3E%5Cn%5Cn%20%20%20%20%3Cdiv%20id=%5C%22result%5C%22%3E%5Cn%20%20%20%20%20%20%3Cdiv%20id=%5C%22fib-js%5C%22%3E%3C/div%3E%5Cn%5Cn%20%20%20%20%20%20%3Cdiv%20id=%5C%22fib-wasm%5C%22%3E%3C/div%3E%5Cn%20%20%20%20%3C/div%3E%5Cn%5Cn%20%20%20%20%3Cscript%3E%5Cn%20%20%20%20%20%20const%20wasm_file%20=%20%5C%22target/wasm32-unknown-unknown/debug/begin_wasm.wasm%5C%22%5Cn%5Cn%20%20%20%20%20%20const%20fib%20=%20n%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20if%20(n%20===%200%20%7C%7C%20n%20===%201)%20%7B%5Cn%20%20%20%20%20%20%20%20%20%20return%201%5Cn%20%20%20%20%20%20%20%20%7D%5Cn%20%20%20%20%20%20%20%20return%20fib(n%20-%201)%20+%20fib(n%20-%202)%5Cn%20%20%20%20%20%20%7D%5Cn%5Cn%20%20%20%20%20%20const%20t1%20=%20Date.now()%5Cn%20%20%20%20%20%20const%20res_js%20=%20fib(40)%5Cn%20%20%20%20%20%20const%20t2%20=%20Date.now()%5Cn%5Cn%20%20%20%20%20%20document.getElementById(%5Cn%20%20%20%20%20%20%20%20%5C%22fib-js%5C%22%5Cn%20%20%20%20%20%20).innerHTML%20=%20%60==JS==:%20Calc%20fib(40),%20time=$%7B(t2%20-%20t1)%20/%5Cn%20%20%20%20%20%20%20%201000%7Ds,%20res=$%7Bres_js%7D%60%5Cn%5Cn%20%20%20%20%20%20const%20memory%20=%20new%20WebAssembly.Memory(%7B%20initial:%2010,%20maximum:%20100%20%7D)%20//%20alloc%20wasm%20memory%20size%5Cn%5Cn%20%20%20%20%20%20WebAssembly.instantiateStreaming(fetch(wasm_file),%20%7B%5Cn%20%20%20%20%20%20%20%20js:%20%7B%20mem:%20memory%20%7D,%5Cn%20%20%20%20%20%20%7D).then(mod%20=%3E%20%7B%5Cn%20%20%20%20%20%20%20%20const%20wasm_exports%20=%20mod.instance.exports%5Cn%5Cn%20%20%20%20%20%20%20%20const%20t1%20=%20Date.now()%5Cn%20%20%20%20%20%20%20%20const%20res_wasm%20=%20wasm_exports.fib(40)%5Cn%20%20%20%20%20%20%20%20const%20t2%20=%20Date.now()%5Cn%5Cn%20%20%20%20%20%20%20%20document.getElementById(%5Cn%20%20%20%20%20%20%20%20%20%20%5C%22fib-wasm%5C%22%5Cn%20%20%20%20%20%20%20%20).innerHTML%20=%20%60==WASM==:%20Calc%20fib(40),%20time=$%7B(t2%20-%20t1)%20/%5Cn%20%20%20%20%20%20%20%20%20%201000%7Ds,%20res=$%7Bres_wasm%7D%60%5Cn%20%20%20%20%20%20%7D)%5Cn%20%20%20%20%3C/script%3E%5Cn%20%20%3C/body%3E%5Cn%20%20%3Chtml%3E%3C/html%3E%5Cn%3C/html%3E%5Cn%60%60%60%5Cn%5Cn##%20%E5%BC%80%E5%90%AF%E6%9C%AC%E5%9C%B0%20http%20server%5Cn%5Cn%E6%9C%AC%E5%9C%B0%E6%B5%8B%E8%AF%95%E7%9A%84%E8%AF%9D%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%9C%89%E5%BE%88%E5%A4%9A%E6%96%B9%E5%BC%8F%E5%BC%80%E5%90%AF%20http%20server%EF%BC%8C%E4%BD%A0%E5%8F%AF%E4%BB%A5%E7%94%A8%20cargo%20%E5%AE%89%E8%A3%85%20rust%20%E7%89%88%E7%9A%84%20http%20server%5Cn%5Cn%60%60%60shell%20script%5Cncargo%20install%20https%5Cn%5Cnhttp%20%20#%20%E5%90%AF%E5%8A%A8http%20server%5Cn%60%60%60%5Cn%5Cn%E4%B9%9F%E5%8F%AF%E4%BB%A5%20nodejs%20%E7%9A%84%20npm%20%E5%AE%89%E8%A3%85%20http%20server%5Cn%5Cn%60%60%60shell%20script%5Cnnpm%20i%20http-server%5Cn%5Cnhttp-server%20.%5Cn%60%60%60%5Cn%5Cn%E7%84%B6%E5%90%8E%E6%89%93%E5%BC%80%E6%B5%8F%E8%A7%88%E5%99%A8(%E6%AF%94%E5%A6%82%E6%88%91%E7%9A%84%20chrome)%EF%BC%8C%E8%BF%9B%E5%88%B0%E6%B5%8B%E8%AF%95%E9%A1%B5%E9%9D%A2,%20benchmark%20%E5%AF%B9%E6%AF%94%EF%BC%9A%5Cn%5Cn!%5B%5D(/assets/images/js-wasm-fib.jpg)%5Cn%5Cn##%20%E6%80%BB%E7%BB%93%5Cn%5Cn%E4%BB%A5%E4%B8%8A%E6%98%AF%E5%AF%B9%E6%AF%94%20js%20%E5%92%8C%20wasm%20%E8%AE%A1%E7%AE%97%20%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97%E7%9A%84%E7%AC%AC%2042%20%E9%A1%B9%EF%BC%8C%E4%B9%9F%E6%98%AF%E5%BE%88%E5%A4%A7%E7%9A%84%E4%B8%80%E4%B8%AA%E6%95%B0%E4%BA%86%EF%BC%8Cjs%20%E7%94%A8%E7%9A%84%E6%97%B6%E9%97%B4%E7%AB%9F%E7%84%B6%E6%AF%94%20wasm%20%E5%B0%91?%EF%BC%88%E4%BB%80%E4%B9%88%E5%8E%9F%E5%9B%A0%E5%91%A2%EF%BC%8C%E5%90%84%E4%BD%8D%E8%A7%82%E4%BC%97%E5%8F%AF%E4%BB%A5%E5%9C%A8%E8%AF%84%E8%AE%BA%E5%8C%BA%E7%95%99%E8%A8%80%E5%8F%91%E8%A1%A8%E7%9C%8B%E6%B3%95:-p%EF%BC%89%5Cnwasm%20%E7%9A%84%E6%80%A7%E8%83%BD%E5%92%8C%20c/c++%E5%B7%AE%E4%B8%8D%E5%A4%9A%EF%BC%8C%E8%BF%99%E9%87%8C%E5%BA%94%E8%AF%A5%E6%98%AF%20chrome%20v8%20%E5%BC%95%E6%93%8E%E5%9C%A8%E5%A4%84%E7%90%86%20js%20%E7%9A%84%E8%AE%A1%E7%AE%97%E6%97%B6%E5%81%9A%E4%BA%86%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96%EF%BC%8C%E8%AE%A9%20js%20%E8%AE%A1%E7%AE%97%20fib(42)%20%E7%94%9A%E8%87%B3%E6%AF%94%20wasm%20%E8%BF%98%E5%BF%AB%E3%80%82%5Cn%5Cn%E5%BD%93%E7%84%B6%E5%B1%80%E9%83%A8%E7%9A%84%20benchmark%20%E5%AF%B9%E6%AF%94%E7%9C%8B%E4%B8%8D%E5%87%BA%E4%BB%80%E4%B9%88%E4%BC%98%E5%8A%BF%EF%BC%8C%E5%9C%A8%E9%87%8D%E8%AE%A1%E7%AE%97%E7%9A%84%E9%A1%B9%E7%9B%AE(cpu%20%E5%AF%86%E9%9B%86%E5%9E%8B)%E4%B8%AD%EF%BC%8Cwasm%20%E7%9A%84%E4%BC%98%E5%8A%BF%E5%B0%B1%E4%BC%9A%E6%AF%94%20js%20%E6%98%8E%E6%98%BE%E3%80%82%5Cn%5Cn%E6%9C%AA%E6%9D%A5%20WASM%20%E4%BC%9A%E5%92%8C%20JS%20%E4%BC%98%E5%8A%BF%E4%BA%92%E8%A1%A5%EF%BC%8C%E4%BA%8C%E8%80%85%E4%B8%8D%E6%98%AF%E5%AF%B9%E7%AB%8B%E7%9A%84%E5%85%B3%E7%B3%BB%EF%BC%8Cwasm%20%E4%B9%9F%E4%B8%8D%E4%BC%9A%E5%8F%96%E4%BB%A3%20js%EF%BC%8Cwasm%20%E5%8F%AA%E6%98%AF%E5%A2%9E%E5%BC%BA%E4%BA%86%20js%EF%BC%8C%E5%B0%B1%E5%83%8F%20typescript%20%E5%8F%AA%E6%98%AF%E7%BB%99%20js%20%E5%8A%A0%E4%BA%86%E7%B1%BB%E5%9E%8B%E5%92%8C%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E3%80%82%5Cn%5Cn%E5%BE%88%E6%84%89%E5%BF%AB%E7%9A%84%20WASM%20%E4%B9%8B%E6%97%85%EF%BC%8Chappy%20coding%20:)%5Cn%22%7D%7D</script><script crossorigin="anonymous" src="/bundle.4aa7f.esm.js" type="module"></script><script nomodule="" src="/polyfills.1cc01.js"></script><script nomodule="" defer="defer" src="/bundle.e8608.js"></script></body></html>